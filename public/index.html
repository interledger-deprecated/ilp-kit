<!DOCTYPE html>
<html lang="en">
  <head>
    <title>NLT KIT</title>
    <meta name="description" content="Network Money">
    <link rel="author" href="https://michielbdejong.com/">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="bulma.min.css">
    <script defer src="fontawesome.min.js"></script>
    <script src="vue.min.js"></script>
  </head>
  <body>
    <div id="app">
      <!--  nav -->
      <div class="tabs">
        <ul>
          <strong class="is-danger button" v-on:click="tab = 'profile'">NLT-KIT</strong>
          <li v-if="session" v-bind:class="{ 'is-active': tab  == 'profile' }" v-on:click="tab = 'profile'"><a>Profile</a></li> 
          <li v-if="session" v-bind:class="{ 'is-active': tab  == 'contacts' }" v-on:click="if (session) { tab = 'contacts' }"><a>Contacts</a></li> 
          <li v-if="session" v-bind:class="{ 'is-active': tab  == 'ledger' }" v-on:click="if (session) { tab = 'ledger' }"><a>Ledger</a></li> 
        </ul>
      </div>
      
      <!-- not logged in -->
      <div v-if="!session && !loggingin && !registering">
        <section class="section">
          <div class="container">
            <a class="button is-large is-info" v-on:click="loggingin=true">Login</a>
            <a class="button is-large is-success" v-on:click="registering=true">Register</a>
         </div>
        </section>
      </div>

      <!-- registration -->
      <div v-if="registering">
        <p>Username: <input v-model="username" placeholder="Pick a username"></p>
        <p>Password: <input v-model="password" type="password" placeholder="Pick a password"></p>
        <p>Repeat: <input v-model="repeat" type="password" placeholder="Repeat your password"></p>
        <p><a class="button is-large is-success" v-on:click="register">Register</a></p>
      </div>

      <!-- login -->
      <div v-if="loggingin">
        <p>Username: <input v-model="username" placeholder="Your username"></p>
        <p>Password: <input v-model="password" type="password" placeholder="Your password"></p>
        <p><a class="button is-large is-info" v-on:click="login">Login</a></p>
      </div>

      <!-- main gui tabs -->
      <div v-if="session">

        <!-- profile tab -->
        <div v-if="tab  ==  'profile'">
          <h2>Welcome, {{ username }}!</h2>
          <div>
            To join the network, trust some people on the contacts tab.
          </div>
          <div>
            To use the network, pay your contacts.
          </div>
          <div>
            See transactions on the ledger tab.
          </div>
        </div>

        <!-- contacts tab, edit: -->
        <div v-if="tab == 'contacts' && edit>-1">
          (editing contact {{ edit }})
          <p>Name: <input v-model="contacts[edit].name" placeholder="Contact name"></p>
          <p>URL: <input v-model="contacts[edit].url" placeholder="URL"></p>
          <p>Token: <input v-model="contacts[edit].token" placeholder="A shared secret"></p>
          <p>Amount you trust them for: <input v-model="contacts[edit].max" placeholder="max"></p>
          <a class="button is-success" v-on:click="save('contacts', edit);edit=-1">
            Done
          </a>
        </div>

        <!-- contacts tab, pay: -->
        <div v-if="tab == 'contacts' && pay>-1">
          (paying {{ contacts[pay].name }})
          <p>Name: <input v-model="contacts[pay].name" placeholder="Contact name"></p>
          <p>Amount: <input v-model="payAmount" placeholder="amount in UCR"></p>
          <a class="button is-success" v-on:click="doPay(pay);pay=-1">
            Done
          </a>
        </div>
        <!-- contacts tab, list: -->
        <div v-if="tab  ==  'contacts' && edit==-1 && pay==-1">
          <section class="section">
            <div class="container">
              
              <a class="button is-success" v-on:click="edit=contacts.length; contacts.push({})">
                Add new contact
              </a>
              <a class="button is-primary" v-on:click="fetchData('contacts')">
                Refresh
              </a>
            </div>
          </section>
          <table  class="table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Min</th>
                <th>Payable</th>
                <th>Current</th>
                <th>Receivable</th>
                <th>Max</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(contact, index) in contacts">
                <td>{{ contact.name }}</td>
                <td>{{ contact.min }}</td>
                <td>{{ contact.payable }}</td>
                <td>{{ contact.current }}</td>
                <td>{{ contact.receivable }}</td>
                <td>{{ contact.max }}</td>
                <td><a class="button" v-on:click="edit=index">Edit</a> <a class="button" v-on:click="pay=index">Pay</a></td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- ledger tab, expand: -->
        <div v-if="tab == 'ledger' && expand>-1">
          (Details of transaction {{ expand }})
          <p>Date: {{ transactions[expand].date }}</p>
          <p>Description: {{ transactions[expand].description }}</p>
          <p>Direction: {{ transactions[expand].direction }}</p>
          <p>Amount: {{ transactions[expand].amount }} UCR</p>
          <a class="button is-success" v-on:click="expand=-1">
            Close
          </a>
        </div>
        <!-- ledger tab, list: -->
        <div v-if="tab == 'ledger' && edit==-1 && expand==-1">
          <section class="section">
            <div class="container">
              <a class="button is-primary" v-on:click="fetchData('transactions')">
                Refresh
              </a>
            </div>
          </section>
          <table  class="table">
            <thead>
              <tr>
                <th>Date</th>
                <th>Description</th>
                <th>Direction</th>
                <th>Amount</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(transaction, index) in transactions">
                <td>{{ transaction.date }}</td>
                <td>{{ transaction.description }}</td>
                <td>{{ transaction.direction }}</td>
                <td>{{ transaction.amount }}</td>
                <td><a class="button" v-on:click="expand=index">Details</a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div><!-- close main gui -->
    </div><!-- close vue app -->
    <script src="app.js"></script>
  </body>
</html>
